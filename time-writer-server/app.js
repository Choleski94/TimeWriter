!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"countLines",value:function(e){for(var t=1,n=0;n<e.length;n++)"\n"===e[n]&&t++;return t}},{key:"getLineBegin",value:function(e,t){for(;t>0&&"\n"!=e[t-1];)t--;return t}},{key:"getLineEnd",value:function(e,t){for(;t<e.length&&"\n"!=e[t];)t++;return t}},{key:"getFragmentWidth",value:function(e,t,n,r){for(var i=r,o=t;o<n;o++)i+=this._getCharacterWidth(e[o],i);return i-r}},{key:"getColumn",value:function(e,t){var n=this.getLineBegin(e,t);return this.getFragmentWidth(e,n,t,0)}},{key:"getLine",value:function(e,t){for(var n=0,r=0;r<t;r++)"\n"==e[r]&&n++;return n}},{key:"getCaretCoordinates",value:function(e,t){return t=this.clipPosition(t,e),{line:this.getLine(e,t),column:this.getColumn(e,t)}}},{key:"getCaretPosition",value:function(e,t){for(var n=0,r=0;r<t.line&&n<e.length;n++)"\n"==e[n]&&r++;for(var i=0;i<t.column&&n<e.length&&"\n"!=e[n];n++)i+=this._getCharacterWidth(e[n],i);return n}},{key:"getEndOfLineColumn",value:function(e,t){var n=this.getLineBegin(e,t),r=this.getLineEnd(e,t);return this.getFragmentWidth(e,n,r,0)}},{key:"getEndOfLinePosition",value:function(e,t){for(;t<e.length&&"\n"!=e[t];)t++;return t}},{key:"getNextFastPosition",value:function(e,t){if(t==e.length)return t;for(var n=this._getCharacterTemplate(e[t]);t<e.length&&n.test(e[t]);)t++;return t}},{key:"getPreviousFastPosition",value:function(e,t){if(0==t)return t;for(var n=this._getCharacterTemplate(e[t-1]);t>0&&n.test(e[t-1]);)t--;return t}},{key:"clipPosition",value:function(e,t){return Math.max(0,Math.min(t.length,e))}},{key:"compareCoordinates",value:function(e,t){return e===t||!!e&&!!t&&e.column===t.column&&e.line==t.line}},{key:"_getCharacterWidth",value:function(e,t){switch(e){case"\t":return 4*Math.ceil((t+1)/4)-t;default:return 1}}},{key:"_getCharacterTemplate",value:function(e){for(var t=[/[\t ]/,/[\w]/,/[^\w\t ]/],n=0;n<t.length;n++){var r=t[n];if(r.test(e))return r}}},{key:"_isWhiteSpace",value:function(e){return/[\n\t ]/.test(e)}},{key:"_isLetter",value:function(e){return/[\w]/.test(e)}},{key:"_isSpecialCharacter",value:function(e){return!this._isLetter(e)&&!this._isWhiteSpace(e)}}])&&r(t.prototype,n),i&&r(t,i),e}();function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this,r=e.text;return o({},e,{carets:e.carets.map(function(e){return n._reduceCaret(r,e,t)})})}},{key:"_reduceCaret",value:function(e,t,n){return t.owner!==n.author?t:this._reduceOwnedCaret(e,t,n)}},{key:"_reduceOwnedCaret",value:function(e,t,n){var r=this.textNavigationService.getCaretCoordinates(e,t.endPosition),i=this._reduceCaretCoordinates(t,r,n),a=this.textNavigationService.getCaretPosition(e,i);return o({},t,{beginPosition:n.select?t.beginPosition:a,endPosition:a,lastOperation:"navigation vertical",endColumn:i.column})}},{key:"_reduceCaretCoordinates",value:function(e,t,n){return{column:"navigation vertical"!==e.lastOperation?t.column:e.endColumn,line:t.line+this._getOffset(n)}}},{key:"_getOffset",value:function(e){return"up"===e.direction?-1:"down"===e.direction?1:void 0}}])&&u(t.prototype,n),r&&u(t,r),e}();function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){l(e,t,n[t])})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return s({},e,{carets:e.carets.map(function(r){return n._reduceCaret(e.text,t,r)})})}},{key:"_reduceCaret",value:function(e,t,n){if(n.owner!==t.author)return n;var r=this._textNavigationService.clipPosition(this._getNewPosition(e,t,n),e);return s({},n,{beginPosition:t.select?n.beginPosition:r,endPosition:r,lastOperation:"navigation horizontal"})}},{key:"_getNewPosition",value:function(e,t,n){return"left"===t.direction&&t.fast?this._textNavigationService.getPreviousFastPosition(e,n.endPosition):"left"===t.direction?n.endPosition-1:"right"===t.direction&&t.fast?this._textNavigationService.getNextFastPosition(e,n.endPosition):"right"===t.direction?n.endPosition+1:void 0}}])&&f(t.prototype,n),r&&f(t,r),e}();function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.verticalNavigationEventReducer=new c,this.horizontalNavigationEventReducer=new v}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return this._getReducer(t).reduce(e,t)}},{key:"_getReducer",value:function(e){switch(e.mode){case"move-horizontally":return this.horizontalNavigationEventReducer;case"move-vertically":return this.verticalNavigationEventReducer}}}])&&h(t.prototype,n),r&&h(t,r),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=e.text.substring(0,t.beginPosition),r=e.text.substring(t.endPosition);return"".concat(n).concat(t.text).concat(r)}}])&&d(t.prototype,n),r&&d(t,r),e}();function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return e.carets.map(function(e){return n._reduceCaret(e,t)})}},{key:"_reduceCaret",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){b(e,t,n[t])})}return e}({},e,{beginPosition:this._reducePosition(e.beginPosition,t),endPosition:this._reducePosition(e.endPosition,t),lastOperation:"insertion"})}},{key:"_reducePosition",value:function(e,t){return e<t.beginPosition?e:e<=t.endPosition?t.beginPosition+t.text.length:e-(t.endPosition-t.beginPosition)+t.text.length}}])&&g(t.prototype,n),r&&g(t,r),e}();function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"getIndentAtPosition",value:function(e,t){for(var n=0,r=t-1;r>=0&&"\n"!==e[r];r--)n=this._reduceIndent(n,e[r]);return n}},{key:"_reduceIndent",value:function(e,t){return"\t"===t?e+1:0}}])&&w(t.prototype,n),r&&w(t,r),e}();function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textFormattingService=new _}var t,n,r;return t=e,(n=[{key:"prepareEvent",value:function(e,t,n){var r=Math.min(n.beginPosition,n.endPosition),i=Math.max(n.beginPosition,n.endPosition);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){P(e,t,n[t])})}return e}({},t,{text:this._prepareEventText(e,t,n),beginPosition:r,endPosition:i})}},{key:"_prepareEventText",value:function(e,t,n){if("\n"!==t.text)return t.text;var r=this._textFormattingService.getIndentAtPosition(e.text,n.beginPosition);return"\n".concat("\t".repeat(r))}}])&&O(t.prototype,n),r&&O(t,r),e}();function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventPreProcessor=new k,this._textReducer=new p,this._caretReducer=new m}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){for(var n in e.carets)e=this._reduceUsingCaret(e,t,e.carets[n]);return e}},{key:"_reduceUsingCaret",value:function(e,t,n){return t.author!==n.owner?e:(t=this._eventPreProcessor.prepareEvent(e,t,n),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){C(e,t,n[t])})}return e}({},e,{text:this._textReducer.reduce(e,t),carets:this._caretReducer.reduce(e,t)}))}}])&&j(t.prototype,n),r&&j(t,r),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=e.text.substring(0,t.beginPosition),r=e.text.substring(t.endPosition);return"".concat(n).concat(r)}}])&&S(t.prototype,n),r&&S(t,r),e}();function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return e.carets.map(function(e){return n._reduceCaret(e,t)})}},{key:"_reduceCaret",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){R(e,t,n[t])})}return e}({},e,{beginPosition:this._reducePosition(e.beginPosition,t),endPosition:this._reducePosition(e.endPosition,t),lastOperation:"deletion"})}},{key:"_reducePosition",value:function(e,t){return e<=t.beginPosition?e:e<=t.endPosition?t.beginPosition:e-(t.endPosition-t.beginPosition)}}])&&T(t.prototype,n),r&&T(t,r),e}();function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"prepareEvent",value:function(e,t,n){var r=n.beginPosition,i=this._getRangeEnd(e,t,n),o=Math.min(r,i),a=Math.max(r,i);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){N(e,t,n[t])})}return e}({},t,{beginPosition:this._clipPosition(e,o),endPosition:this._clipPosition(e,a),caret:n})}},{key:"_getRangeEnd",value:function(e,t,n){return n.beginPosition!=n.endPosition?n.endPosition:"backward"==t.mode&&t.fast?this._textNavigationService.getPreviousFastPosition(e.text,n.endPosition):"backward"==t.mode?n.beginPosition-1:"forward"==t.mode&&t.fast?this._textNavigationService.getNextFastPosition(e.text,n.endPosition):"forward"==t.mode?n.beginPosition+1:n.endPosition}},{key:"_clipPosition",value:function(e,t){return Math.max(0,Math.min(e.text.length,t))}}])&&M(t.prototype,n),r&&M(t,r),e}();function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var F=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventPreProcessor=new A,this._textReducer=new x,this._caretReducer=new D}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){for(var n in e.carets)e=this._reduceUsingCaret(e,t,e.carets[n]);return e}},{key:"_reduceUsingCaret",value:function(e,t,n){return t.author!==n.owner?e:(t=this._eventPreProcessor.prepareEvent(e,t,n),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}({},e,{text:this._textReducer.reduce(e,t),carets:this._caretReducer.reduce(e,t)}))}}])&&L(t.prototype,n),r&&L(t,r),e}();function U(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){z(e,t,n[t])})}return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return W({},e,{carets:this._reduceCarets(e,t)})}},{key:"_reduceCarets",value:function(e,t){switch(t.placement){case"position":return this._addCaretOnPosition(e,t);case"all":return this._addCaretOnAll(e,t);case"above":return this._addCaretsVertically(e,t,-1);case"below":return this._addCaretsVertically(e,t,1)}}},{key:"_addCaretOnPosition",value:function(e,t){var n=this._textNavigationService.clipPosition(t.position,e.text);return U(this._processOldCarets(e.carets,t)).concat([{owner:t.author,beginPosition:n,endPosition:n,lastOperation:"creation"}])}},{key:"_processOldCarets",value:function(e,t){return t.preserveExisting?e:e.filter(function(e){return e.owner!==t.author})}},{key:"_addCaretOnAll",value:function(e,t){return U(e.carets).concat([{owner:t.author,beginPosition:0,endPosition:e.text.length,lastOperation:"creation"}])}},{key:"_addCaretsVertically",value:function(e,t,n){var r=this,i=e.carets.filter(function(e){return e.owner===t.author}).map(function(t){return r._reduceCaretVertically(e,t,n)});return U(e.carets).concat(U(i))}},{key:"_reduceCaretVertically",value:function(e,t,n){var r=this._textNavigationService.getCaretCoordinates(e.text,t.beginPosition),i=this._reduceCoordinatesVertically(r,t.beginColumn,t.lastOperation,n),o=this._textNavigationService.getCaretCoordinates(e.text,t.endPosition),a=this._reduceCoordinatesVertically(o,t.endColumn,t.lastOperation,n);return W({},t,{beginPosition:this._textNavigationService.getCaretPosition(e.text,i),endPosition:this._textNavigationService.getCaretPosition(e.text,a),beginColumn:i.column,endColumn:a.column,lastOperation:"creation vertical"})}},{key:"_reduceCoordinatesVertically",value:function(e,t,n,r){return{column:"creation vertical"!==n?e.column:t,line:e.line+r}}}])&&V(t.prototype,n),r&&V(t,r),e}();function B(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){H(e,t,n[t])})}return e}({},e,{carets:this._reduceCarets(e.carets,t)})}},{key:"_reduceCarets",value:function(e,t){return B(this._getOtherUsersCarets(e,t)).concat(B(this._getNewCarets(e,t)))}},{key:"_getOtherUsersCarets",value:function(e,t){return e.filter(function(e){return e.owner!=t.author})}},{key:"_getNewCarets",value:function(e,t){if(!t.leaveFirst)return[];var n=e.filter(function(e){return e.owner===t.author});if(!n.length)return[];var r=Math.min.apply(Math,B(n.map(function(e){return e.endPosition})));return[{owner:t.author,beginPosition:r,endPosition:r,lastOperation:"creation"}]}}])&&K(t.prototype,n),r&&K(t,r),e}();function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Q(e,t,n[t])})}return e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._textNavigationService=new i}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){var n=this;return G({},e,{carets:e.carets.map(function(r){return n._reduceCaret(e,t,r)})})}},{key:"_reduceCaret",value:function(e,t,n){return n.owner!=t.author?n:G({},n,{beginPosition:n.beginPosition,endPosition:this._textNavigationService.clipPosition(t.position,e.text),lastOperation:"selection"})}}])&&X(t.prototype,n),r&&X(t,r),e}();function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.caretCreationEventReducer=new q,this.caretRemovalEventReducer=new J,this.selectionEventReducer=new Y}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e,t){return this._getReducer(t).reduce(e,t)}},{key:"_getReducer",value:function(e){switch(e.operation){case"add-caret":return this.caretCreationEventReducer;case"remove-carets":return this.caretRemovalEventReducer;case"select":return this.selectionEventReducer}}}])&&Z(t.prototype,n),r&&Z(t,r),e}();function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reduce",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ee(e,t,n[t])})}return e}({},e,{carets:this._removeDuplicateCarets(e.carets)})}},{key:"_removeDuplicateCarets",value:function(e){var t=this;return e.filter(function(n,r){return r===e.findIndex(function(e){return t._compareCarets(n,e)})})}},{key:"_compareCarets",value:function(e,t){return e.owner===t.owner&&Math.min(e.beginPosition,e.endPosition)===Math.min(t.beginPosition,t.endPosition)&&Math.max(e.beginPosition,e.endPosition)===Math.max(t.beginPosition,t.endPosition)}}])&&te(t.prototype,n),r&&te(t,r),e}();function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.insertionEventReducer=new E,this.deletionEventReducer=new F,this.navigationEventReducer=new y,this.caretManagementEventReducer=new $,this.postprocessingReducer=new ne}var t,n,r;return t=e,(n=[{key:"_getReducer",value:function(e){switch(e.type){case"insert":return this.insertionEventReducer;case"delete":return this.deletionEventReducer;case"navigate":return this.navigationEventReducer;case"manage-carets":return this.caretManagementEventReducer;default:throw new Error("Event not recognized")}}},{key:"reduce",value:function(e,t){var n=this._getReducer(t);return this.postprocessingReducer.reduce(n.reduce(e,t))}}])&&re(t.prototype,n),r&&re(t,r),e}();function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"_getTimestamp",value:function(e,t){return e[t].event.timestamp}},{key:"_inRange",value:function(e,t){return t>=0&&t<e.length}},{key:"_cleanState",value:function(e,t){e[t].state=null}},{key:"_isTooFarAhead",value:function(e,t){return!!this._inRange(e,t+1)&&this._getTimestamp(e,t)<this._getTimestamp(e,t+1)}},{key:"_moveBackward",value:function(e,t){var n=e[t+1];e[t+1]=e[t],e[t]=n,this._cleanState(e,t),this._cleanState(e,t+1)}},{key:"fix",value:function(e){for(var t=0;this._isTooFarAhead(e,t);)this._moveBackward(e,t++)}}])&&oe(t.prototype,n),r&&oe(t,r),e}();function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._eventReducer=new ie}var t,n,r;return t=e,(n=[{key:"updateCurrentState",value:function(e){e[0].state=this._getState(e,0)}},{key:"_getState",value:function(e,t){for(var n=this,r=new Map,i=[];r.size||!e[t].state;){var o=e[t].event;this._isHistoryEvent(o)||this._shouldUndo(r,o)||i.push(o),this._updateUndoLevel(r,o),t++}return i.reduceRight(function(e,t){return n._reduceState(e,t)},e[t].state)}},{key:"_updateUndoLevel",value:function(e,t){var n=this._getKey(t.author);e.has(n)||e.set(n,0);var r=e.get(n);"redo"===t.type?r--:"undo"===t.type?r++:r>0&&r--,0===r?e.delete(n):e.set(n,r)}},{key:"_shouldUndo",value:function(e,t){var n=this._getKey(t.author);return e.has(n)}},{key:"_getKey",value:function(e){return e||null}},{key:"_reduceState",value:function(e,t){return this._isHistoryEvent(t)?e:this._eventReducer.reduce(e,t)}},{key:"_isHistoryEvent",value:function(e){return"undo"==e.type||"redo"===e.type}}])&&ue(t.prototype,n),r&&ue(t,r),e}();function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var le=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"_cleanupStates",value:function(e){for(var t=this._closestIndexWithState(e,Math.min(12,e.length-1)),n=1;n<t;n++)e[n].state=null}},{key:"_closestIndexWithState",value:function(e,t){for(;!e[t].state;)t--;return t}},{key:"_cleanupLength",value:function(e){e.length<400||e.splice(this._closestIndexWithState(e,350)+1)}},{key:"cleanup",value:function(e){this._cleanupLength(e),this._cleanupStates(e)}}])&&se(t.prototype,n),r&&se(t,r),e}();function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"validate",value:function(e){if(e[0].state.text.length>1e4)throw new Error("File too long")}}])&&fe(t.prototype,n),r&&fe(t,r),e}();function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ye=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"tryUpdateTimestamp",value:function(e,t,n){var r=this._findNodeIndex(e,t);if(-1===r)throw new Error("Event not found");if(r===e.length-1)throw new Error("An attempt to update last node is an invalid operation");return!!this._canUpdateTimestampWithoutMovingNode(e,r,n)&&(e[r].event.timestamp=n,!0)}},{key:"_canUpdateTimestampWithoutMovingNode",value:function(e,t,n){return(0===t||e[t-1].event.timestamp>=n)&&e[t+1].event.timestamp<=n}},{key:"_findNodeIndex",value:function(e,t){return e.findIndex(function(e){return e.event===t})}}])&&he(t.prototype,n),r&&he(t,r),e}();function de(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"addEvent",value:function(e,t){return[{event:t,state:null}].concat(de(e))}},{key:"removeEvent",value:function(e,t){for(var n=e.findIndex(function(e){return e.event===t}),r=e.filter(function(e,t){return t!==n}),i=0;i<n;i++)r[i].state=null;return r}}])&&pe(t.prototype,n),r&&pe(t,r),e}();function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var we=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._chain=t,this._eventReducer=new ie,this._eventStoreChainReducer=new be,this._eventStoreRepair=new ae,this._eventStoreState=new ce,this._eventStoreCleanup=new le,this._eventStoreValidation=new ve,this._eventStoreRetrospector=new ye}var t,n,r;return t=e,(n=[{key:"add",value:function(e){try{var t=this._eventStoreChainReducer.addEvent(this._chain,e);this._eventStoreRepair.fix(t),this._eventStoreState.updateCurrentState(t),this._eventStoreCleanup.cleanup(t),this._eventStoreValidation.validate(t),this._chain=t}catch(e){return console.dir(e),!1}return!0}},{key:"updateTimestamp",value:function(e,t){try{return!!this._eventStoreRetrospector.tryUpdateTimestamp(this._chain,e,t)||(console.log("Updating chain"),this._chain=this._eventStoreChainReducer.removeEvent(this._chain,e),this.add(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ge(e,t,n[t])})}return e}({},e,{timestamp:t})))}catch(e){return console.dir(e),!1}}},{key:"history",get:function(){return this._chain}},{key:"state",get:function(){return this._chain[0].state}}])&&me(t.prototype,n),r&&me(t,r),e}(),_e="import React, {Component} from 'react';\n\nexport default class MyComponent extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\t\n\t\tthis.click = this.click.bind(this);\n\t}\n\t\n\tclick() {\n\t\tconsole.log('Hello world');\n\t}\n\t\n\trender() {\n\t\treturn (\n\t\t\t<div click={this.click}>\n\t\t\t\tClick me\n\t\t\t</div>\n\t\t);\n\t}\n}";function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Oe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t||(t=[{event:{timestamp:Date.now()},state:{carets:[],text:_e}}]),this._eventStore=new we(t)}var t,n,r;return t=e,(n=[{key:"addEvent",value:function(e){return this._eventStore.add(e)}},{key:"updateTimestamp",value:function(e,t){return this._eventStore.updateTimestamp(e,t)}},{key:"history",get:function(){return this._eventStore.history}},{key:"state",get:function(){return this._eventStore.state}}])&&Pe(t.prototype,n),r&&Pe(t,r),e}();function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ce=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._documents=new Map}var t,n,r;return t=e,(n=[{key:"getDocument",value:function(e){this._createIfDoesntExist(e);var t=this._documents.get(e);return t.lastAccess=new Date,t}},{key:"removeOldDocuments",value:function(){var e=new Date;e.setDate(e.getDate()-3);var t=!0,n=!1,r=void 0;try{for(var i,o=this._documents.keys()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._documents.get(a).lastAccess<e&&this._documents.delete(a)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"_createIfDoesntExist",value:function(e){this._documents.has(e)||this._documents.set(e,new Oe)}}])&&ke(t.prototype,n),r&&ke(t,r),e}());t.a=Ce},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("node-schedule")},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0);function i(e,t){var n=r.a.getDocument(e.params.documentId).history;t.json(n)}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(0);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._socket=t,this._documentId=t.handshake.query.document,this._document=r.a.getDocument(this._documentId),this._initialize()}var t,n,a;return t=e,(n=[{key:"_initialize",value:function(){this._socket.join(this._documentId),this._socket.emit("document snapshot",this._document.history),this._socket.on("document change",this._onDocumentChanged.bind(this)),this._socket.on("disconnect",this._onDisconected.bind(this))}},{key:"_prepareEvent",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){i(e,t,n[t])})}return e}({},e,{timestamp:Date.now(),author:this._socket.id})}},{key:"_addEvent",value:function(e){var t=this._prepareEvent(e);return this._document.addEvent(t)?(this._broadcastEvent(t),t.timestamp):null}},{key:"_broadcastEvent",value:function(e){this._socket.broadcast.to(this._documentId).emit("document change",e)}},{key:"_onDocumentChanged",value:function(e,t){try{t(this._addEvent(e))}catch(e){console.log(e),t(null)}}},{key:"_onDisconected",value:function(){this._addEvent({type:"manage-carets",operation:"remove-carets"})}}])&&o(t.prototype,n),a&&o(t,a),e}();function u(e){new a(e)}},function(e,t,n){n(10),e.exports=n(11)},function(e,t){e.exports=require("@babel/polyfill")},function(e,t,n){"use strict";n.r(t),function(e){var t=n(2),r=n.n(t),i=n(1),o=n.n(i),a=n(3),u=n.n(a),c=n(4),s=n.n(c),l=n(5),f=n.n(l),v=n(6),h=n.n(v),y=n(7),d=n(8),p=n(0),b=process.env.PORT||1337,g=o()();g.use(o.a.static(s.a.join(e,"public"))),g.use(f()({origin:["https://text-sourcing.tomasz-rewak.com"]})),g.get(["/document/:documentId"],y.a);var m=r.a.Server(g),w=new u.a(m);w.origins(["https://text-sourcing.tomasz-rewak.com:443"]),w.on("connection",d.a),m.listen(b,function(){return console.log("Example app listening on port ".concat(b,"!"))}),h.a.scheduleJob({hour:0,minute:0},function(){p.a.removeOldDocuments()})}.call(this,"/")}]);